<?xml version="1.0" encoding="UTF-8"?>

<project basedir="." default="generate-artifacts" name="NFV-SOL2">
	<description>
			Script for NFV Assignment 3 solution
	</description>
	
    <property name="basedir"     location="." />
    <property name="sol.src.dir" location="${basedir}/src" />
    <property name="sol.build.dir" location="${basedir}/build" />
	<property name="gen.src.dir" location="${basedir}/gen-src" />
	
	<property name="service.src.dir" location="${sol.src.dir}/it/polito/dp2/NFV/sol3/service" />
	<property name="client1.src.dir" location="${sol.src.dir}/it/polito/dp2/NFV/sol3/client1" />
	<property name="client2.src.dir" location="${sol.src.dir}/it/polito/dp2/NFV/sol3/client2" />
	<property name="model.src.dir"   location="${gen.src.dir}/it/polito/dp2/NFV/sol3/model" />

	
	<property name="neo4j.artifacts.src.dir"       location="${model.src.dir}/neo4j" />
	<property name="nfvdeployer.artifacts.src.dir" location="${model.src.dir}/nfvdeployer" />


	
	<path id="service.classpath">
    	<pathelement location="${lib.dir}/NFV.jar"/>
        <pathelement location="${lib.dir}/lab3.jar"/>
        <pathelement location="${lib.dir}/swagger-annotations-1.5.0.jar"/>
        <pathelement location="${ext.lib.dir}/javax.ws.rs-api-2.0.1.jar"/>
        <pathelement location="${ext.lib.dir}/jersey-client-1.19.1.jar"/>
        <pathelement location="${ext.lib.dir}/jersey-core-1.19.1.jar"/>
        <pathelement location="${ext.lib.dir}/jersey-server-2.25.1.jar"/>
        <pathelement location="${ext.lib.dir}/jersey-common-2.25.1.jar"/>
    </path>
	
	<path id="clients.classpath">
		<pathelement location="${lib.dir}/NFV.jar"/>
        <pathelement location="${lib.dir}/lab3.jar"/>
		<pathelement location="${ext.lib.dir}/javax.ws.rs-api-2.0.1.jar"/>
		<pathelement location="${ext.lib.dir}/jersey-client-1.19.1.jar"/>
        <pathelement location="${ext.lib.dir}/jersey-core-1.19.1.jar"/>
	    <pathelement location="${ext.lib.dir}/jersey-common-2.25.1.jar"/>
	</path>
	
	
	<!-- define wjc task (WADL to Java) -->
	<taskdef name="wjc" classname="org.jvnet.ws.wadl2java.WJCTask">
	    <classpath>
		  <fileset dir="${ext.lib.dir}" includes="*.jar"/>
	    </classpath>
	</taskdef>
	
	<target name="sol-init">
        <mkdir dir="${sol.build.dir}"/>
		<mkdir dir="${gen.src.dir}" />
	</target>
	
	
	<!-- Generate NfvDeployer artifacts -->
	<target name="generate-neo4j-artifacts" depends="sol-init">
		<echo message="Compiling the neo4j WADL descriptions..." />
		
		<wjc description="${Neo4JSimpleXMLWADL}" package="it.polito.dp2.NFV.sol3.model.neo4j" 
		          autoSchemaPackage="false" target="${gen.src.dir}">
			<produces dir="${neo4j.artifacts.src.dir}" includes="*.java"/>
			<depends dir="${basedir}" includes="build.xml"/>
			<customClassName uri="${URL}" classname="Neo4JSCS"/>
		</wjc>
		
		<echo message="Done." />
	</target>
	
	<!-- Generate NfvDeployer artifacts -->
    <target name="generate-nfvdeployer-artifacts" depends="sol-init">
            <echo message="Compiling the xsd NfvDeployer file..." />
            <exec executable="xjc" failonerror="true" >
                <arg value="-d" />
                <arg value="${gen.src.dir}" />
                <arg value="-p" />
                <arg value="it.polito.dp2.NFV.sol3.model.nfvdeployer" />
                <arg value="${basedir}/xsd/NfvDeployer.xsd" />
            </exec>
            <echo message="Done." />
    </target>
	
	<target name="build-service" depends="generate-neo4j-artifacts, generate-nfvdeployer-artifacts">
		<echo message="Building sol3.service..." />
        <javac 
            destdir="${build.dir}"
            debug="${debug}"
            debuglevel="${debuglevel}"
            source="${source}"
            target="${target}"
            includeantruntime="false">
                <src path="${sol.src.dir}"/>
        	    <src path="${gen.src.dir}"/>
                <include name="it/polito/dp2/NFV/sol3/service/**" />
        	    <include name="it/polito/dp2/NFV/sol3/model/**" />
                <classpath>
                    <path refid="service.classpath" />
                </classpath>
        </javac>
        <echo message="Done." />
	</target>
	

	<target name="build-client" depends="generate-nfvdeployer-artifacts">
		<echo message="Building sol3.client1..." />
		<javac 
            destdir="${build.dir}"
            debug="${debug}"
            debuglevel="${debuglevel}"
            source="${source}"
            target="${target}"
		    includeantruntime="false">
			    <src path="${sol.src.dir}"/>
			    <src path="${gen.src.dir}"/>
			    <include name="it/polito/dp2/NFV/sol3/client1/**" />
			    <include name="it/polito/dp2/NFV/sol3/model/nfvdeployer/**" />
			    <classpath>
			        <path refid="clients.classpath" />
			    </classpath>
		</javac>
		<echo message="Done." />
		<echo message="Building sol3.client2..." />
		        <javac 
		            destdir="${build.dir}"
		            debug="${debug}"
		            debuglevel="${debuglevel}"
		            source="${source}"
		            target="${target}"
		            includeantruntime="false">
		                <src path="${sol.src.dir}"/>
		              	<src path="${gen.src.dir}"/>
		                <include name="it/polito/dp2/NFV/sol3/client2/**" />
	                    <include name="it/polito/dp2/NFV/sol3/model/nfvdeployer/**" />
		                <classpath>
		                    <path refid="clients.classpath" />
		                </classpath>
		        </javac>
		        <echo message="Done." />
	</target>


    <target name="sol-clean">
        <delete dir="${sol.build.dir}"/>
        <delete dir="${gen.src.dir}"/>
    </target>


</project>
